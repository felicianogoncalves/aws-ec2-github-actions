# Nome do workflow que aparece no GitHub Actions
name: Deploy EC2

# Define o gatilho (quando o workflow é executado)
on:
  workflow_dispatch:  # Permite executar manualmente o workflow na interface do GitHub

# Define os jobs (tarefas) a serem executadas
jobs:
  deploy:  # Nome do job (podes escolher outro nome se quiseres)
    runs-on: ubuntu-latest  # Usa um runner do GitHub com Ubuntu mais recente

    steps:
      # Passo 1: Configura as credenciais da AWS
      - name: Configure AWS credentials  # Nome descritivo deste passo
        uses: aws-actions/configure-aws-credentials@v4  # Action oficial da AWS para autenticação
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}        # Chave de acesso da AWS (guardada como segredo no GitHub)
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }} # Chave secreta (também guardada como segredo)
          aws-region: us-west-2  # Região da AWS onde a instância será criada (Londres)

      # Passo 2: Lança a instância EC2 com a AWS CLI
      #   • Imagem: Ubuntu 24.04 LTS (ami-0a0ff88d0f3f85a14)
      #   • Tipo: t2.micro (gratuito na camada gratuita)
      #   • Chave SSH: ec2-key (deve existir na AWS)
      #   • Tag: Name = GitHub-EC2
      - name: Launch EC2 Instance (Ubuntu 24.04 LTS)  # Nome descritivo do passo
        run: |
          aws ec2 run-instances \
            --image-id ami-00f46ccd1cbfb363e --count 1 --instance-type t3.micro --key-name ec2-key --tag-specifications 'ResourceType=instance,Tags=[{Key=Name,Value=GitHub-EC2}]'  
