name: Deploy Azure VM

on:
  workflow_dispatch:
    inputs:
      instance-name:
        description: "Nome da VM no Azure"
        required: true
        default: "GitHub-VM"

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Passo 1: Login no Azure usando Service Principal
      - name: Login no Azure
        uses: azure/login@v2
        with:
          client-id: ${{ secrets.AZURE_CLIENT_ID }}
          tenant-id: ${{ secrets.AZURE_TENANT_ID }}
          subscription-id: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
          client-secret: ${{ secrets.AZURE_CLIENT_SECRET }}

      # Passo 2: Criar grupo de recursos (se n√£o existir)
      - name: Criar Resource Group
        run: |
          az group create --name GitHub-RG --location westeurope

      # Passo 3: Criar VM Linux (Ubuntu)
      - name: Criar VM no Azure
        run: |
          az vm create \
            --resource-group GitHub-RG \
            --name ${{ github.event.inputs.instance-name }} \
            --image Ubuntu2204 \
            --size Standard_B1s \
            --admin-username azureuser \
            --generate-ssh-keys